<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">
<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes" ?>
<?rfc strict="no" ?>
<?rfc rfcedstyle="yes" ?>
<?rfc subcompact="no" ?>
<rfc
    xmlns:xi="http://www.w3.org/2001/XInclude"
    ipr="trust200902"
    category="info"
    docName="draft-handte-hybi-zstd-pcme-latest"
    obsoletes=""
    updates=""
    submissionType="IETF"
    xml:lang="en"
    tocInclude="true"
    symRefs="true"
    sortRefs="true"
    version="3">
  <front>
    <title abbrev="Zstd PCME">
      A Zstandard Per-Message Compression Extension for WebSocket
    </title>
    <seriesInfo name="Internet-Draft" value="draft-handte-hybi-zstd-pcme-latest"/>

    <author initials="W. F. P." surname="Handte" fullname="W. Felix P. Handte">
      <organization>Facebook, Inc.</organization>
      <address>
        <postal>
          <street>770 Broadway</street>
          <city>New York</city>
          <region>NY</region>
          <code>10003</code>
          <country>US</country>
        </postal>
        <email>w@felixhandte.com</email>
      </address>
    </author>

    <author initials="F" surname="Gasper" fullname="Felipe Gasper">
      <organization>[TODO]</organization>
      <address>
        <postal>
          <street>[TODO]</street>
          <city>[TODO]</city>
          <region>[TODO]</region>
          <code>[TODO]</code>
          <country>[TODO]</country>
        </postal>
        <email>felipe@felipegasper.com</email>
      </address>
    </author>

    <date/>
    <area>ART</area>
    <workgroup>Individual submission</workgroup>
    <keyword>Zstandard</keyword>
    <keyword>Zstd</keyword>
    <keyword>Compression</keyword>
    <keyword>WebSocket</keyword>

    <abstract>
      <t>
        This document defines a Per-Message Compression Extension <xref target="RFC7692"/> for the WebSocket Protocol <xref target="RFC6455"/> based on the Zstandard compression format <xref target="RFC8478"/>. This extension is then registered under the name <tt>permessage-zstd</tt>.
      </t>
      <t>
        <cref>TODO</cref>
      </t>
    </abstract>

    <note>
      <name>Draft Development</name>
      <t>
        <cref>RFC Editor: Please remove this section before publication.</cref>
      </t>
      <t>
        The source code and issues list for this draft can be found at <eref target="https://github.com/felixhandte/draft-handte-hybi-zstd-pcme"/>.
      </t>
      <t>
        Discussion of this draft takes place on the BiDirectional or Server-Initiated working group mailing list (<eref target="mailto:hybi@ietf.org"/>), which is archived at <eref target="https://mailarchive.ietf.org/arch/browse/hybi/"/>.
      </t>
    </note>
  </front>

  <middle>
    <section anchor="intro">
      <name>Introduction</name>
      <t>
        This document defines a Per-Message Compression Extension <xref target="RFC7692"/> for the WebSocket Protocol <xref target="RFC6455"/> based on the Zstandard compression format <xref target="RFC8478"/>.
      </t>
      <t>
        This extension is modeled on the <tt>permessage-deflate</tt> extension defined in <xref target="RFC7692"/>. It attempts as much as possible to present a compatible interface to its users, differing only internally (primarily in the use of a different underlying compression scheme and then how it maps the same options as the <tt>permessage-deflate</tt> extension to the configuration of Zstandard).
      </t>
    </section>
    <section anchor="defs">
      <name>Definitions</name>
      <section anchor="defs-reqs">
        <name>Requirements</name>
        <t>
          The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as described in <xref target="RFC2119"/>.
        </t>
      </section>
      <section anchor="defs-ws">
        <name>WebSocket Terminology</name>
        <t>
          This document references the procedure to <em>Fail the WebSocket Connection</em>. This procedure is defined in <xref target="RFC6455" section="7.1.7"/>.
        </t>
        <t>
          This document references the event that <em>The WebSocket Connection is Established</em> and the event that <em>A WebSocket Message Has Been Received</em>. These events are defined in Sections <relref section="4.1" target="RFC6455" displayFormat="bare"/> and <relref section="6.2" target="RFC6455" displayFormat="bare"/>, respectively, of <xref target="RFC6455"/>.
        </t>
      </section>
      <section anchor="defs-zstd">
        <name>Zstandard Definitions</name>
        <t>
          This document talks about Zstandard frames
        </t>
      </section>
    </section>
    <section anchor="extension-params">
      <name>Extension Parameters</name>
      <t>
        <cref>TODO</cref>
      </t>
      <section anchor="extension-param-server-no-context-takeover">
        <name><tt>server_no_context_takeover</tt></name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
      <section anchor="extension-param-client-no-context-takeover">
        <name><tt>client_no_context_takeover</tt></name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
      <section anchor="extension-param-server-max-window-bits">
        <name><tt>server_max_window_bits</tt></name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
      <section anchor="extension-param-client-max-window-bits">
        <name><tt>client_max_window_bits</tt></name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
    </section>
    <section anchor="transformation">
      <name>Message Payload Transformation</name>
      <section anchor="compression">
        <name>Compression</name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
      <section anchor="decompression">
        <name>Decompression</name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
    </section>
    <section anchor="iana">
      <name>IANA Considerations</name>
      <section anchor="iana-websocket-extension-registry">
        <name>WebSocket Extension Name</name>
        <t>
          IANA is requested to register the following WebSocket extension name in the "WebSocket Extension Name Registry" defined in <xref target="RFC6455"/>.
        </t>
        <dl>
          <dt>Extension Identifier:</dt>
          <dd><tt>permessage-zstd</tt></dd>
          <dt>Extension Common Name:</dt>
          <dd>WebSocket Per-Message Compression using Zstandard</dd>
          <dt>Extension Definition:</dt>
          <dd>This document</dd>
          <dt>Known Incompatible Extensions:</dt>
          <dd>None</dd>
        </dl>
        <t>
          The <tt>permessage-zstd</tt> extension name is used in the <tt>Sec-WebSocket-Extensions</tt> header in the WebSocket opening handshake to negotiate use of the <tt>permessage-zstd</tt> extension.
        </t>
      </section>
    </section>
    <section anchor="security">
      <name>Security Considerations</name>
      <t>
        <cref>TODO</cref>
        <xref target="CRIME"/>
      </t>
    </section>
    <section anchor="future-work">
      <name>Future Work</name>
      <t>
        <cref>TODO</cref>
      </t>
      <section anchor="future-work-independent-negotiation">
        <name>Independent Negotiation for Each Direction</name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
      <section anchor="future-work-dictionaries">
        <name>Dictionaries</name>
        <t>
          <cref>TODO</cref>
        </t>
      </section>
    </section>
  </middle>

  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>

        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <seriesInfo name="DOI" value="10.17487/RFC2119"/>
            <seriesInfo name="RFC" value="2119"/>
            <seriesInfo name="BCP" value="14"/>
            <author initials="S." surname="Bradner" fullname="Scott Bradner">
              <organization>Harvard University</organization>
            </author>
            <date year="1997" month="March"/>
            <abstract>
              <t>
              In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.
              </t>
            </abstract>
          </front>
        </reference>

        <reference anchor="RFC6455" target="https://www.rfc-editor.org/info/rfc6455">
          <front>
            <title>The WebSocket Protocol</title>
            <seriesInfo name="DOI" value="10.17487/RFC6455"/>
            <seriesInfo name="RFC" value="6455"/>
            <author initials="I." surname="Fette" fullname="I. Fette">
              <organization>Google, Inc.</organization>
            </author>
            <author initials="A." surname="Melnikov" fullname="A. Melnikov">
              <organization>Isode Ltd.</organization>
            </author>
            <date year="2011" month="December"/>
            <abstract>
              <t>
              The WebSocket Protocol enables two-way communication between a client running untrusted code in a controlled environment to a remote host that has opted-in to communications from that code. The security model used for this is the origin-based security model commonly used by web browsers. The protocol consists of an opening handshake followed by basic message framing, layered over TCP. The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g., using XMLHttpRequest or &lt;iframe&gt;s and long polling).
              </t>
            </abstract>
          </front>
        </reference>

        <reference anchor="RFC7692" target="https://www.rfc-editor.org/info/rfc7692">
          <front>
            <title>Compression Extensions for WebSocket</title>
            <seriesInfo name="DOI" value="10.17487/RFC7692"/>
            <seriesInfo name="RFC" value="7692"/>
            <author initials="T." surname="Yoshino" fullname="T. Yoshino">
              <organization>Google, Inc.</organization>
            </author>
            <date year="2015" month="December"/>
            <abstract>
              <t>
              This document defines a framework for creating WebSocket extensions that add compression functionality to the WebSocket Protocol. An extension based on this framework compresses the payload data portion of WebSocket data messages on a per-message basis using parameters negotiated during the opening handshake. This framework provides a general method for applying a compression algorithm to the contents of WebSocket messages. Each compression algorithm has to be defined in a document defining the extension by specifying the parameter negotiation and the payload transformation algorithm in detail. This document also specifies one specific compression extension using the DEFLATE algorithm.
              </t>
            </abstract>
          </front>
        </reference>

        <reference anchor="RFC8478" target="https://www.rfc-editor.org/info/rfc8478">
          <front>
            <title>Zstandard Compression and the application/zstd Media Type</title>
            <seriesInfo name="DOI" value="10.17487/RFC8478"/>
            <seriesInfo name="RFC" value="8478"/>
            <author initials="Y." surname="Collet" fullname="Y. Collet">
              <organization>Facebook, Inc.</organization>
            </author>
            <author initials="M." surname="Kucherawy" fullname="M. Kucherawy" role="editor">
              <organization>Facebook, Inc.</organization>
            </author>
            <date year="2018" month="October"/>
            <abstract>
              <t>
              Zstandard, or "zstd" (pronounced "zee standard"), is a data compression mechanism. This document describes the mechanism and registers a media type and content encoding to be used when transporting zstd-compressed content via Multipurpose Internet Mail Extensions (MIME).
              </t>
              <t>
              Despite use of the word "standard" as part of its name, readers are advised that this document is not an Internet Standards Track specification; it is being published for informational purposes only.
              </t>
            </abstract>
          </front>
        </reference>
      </references>

      <references>
        <name>Informative References</name>

        <reference anchor="CRIME" target="https://www.ekoparty.org/archive/2012/CRIME_ekoparty2012.pdf">
          <front>
            <title>Compression Ratio Info-leak Made Easy</title>
            <author initials="J." surname="Rizzo" fullname="Juliano Rizzo"/>
            <author initials="T." surname="Duong" fullname="Thai Duong"/>
            <date year="2012"/>
          </front>
        </reference>
      </references>
    </references>
  </back>
</rfc>
